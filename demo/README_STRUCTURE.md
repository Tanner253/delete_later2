# Demo Folder Structure & Dependencies

## âš ï¸ IMPORTANT: Demo is NOT Self-Contained

**The `demo` folder CANNOT be taken out and run independently!**

The demo depends on the parent PayPortal project to function properly.

---

## ğŸ“ What's in the Demo Folder

```
demo/
â”œâ”€â”€ index.html          # Interactive web UI
â””â”€â”€ README.md          # Demo documentation
```

---

## ğŸ”— Required Dependencies (Outside Demo Folder)

The demo **requires** these files from the parent project:

### 1. **demo-server.js** (in root directory)
- **Location:** `../demo-server.js`
- **Purpose:** Runs the PayPortal server with mock chains
- **Serves:** The demo UI at `/demo`
- **Cannot move:** It imports from `./dist/index.js`

### 2. **dist/index.js** (built PayPortal library)
- **Location:** `../dist/`
- **Purpose:** The compiled PayPortal server library
- **Generated by:** `npm run build`
- **Cannot move:** Required by demo-server.js

### 3. **node_modules/** (dependencies)
- **Location:** `../node_modules/`
- **Purpose:** Express, CORS, and other dependencies
- **Generated by:** `npm install`
- **Cannot move:** Required by the PayPortal library

### 4. **swagger.json** (API documentation)
- **Location:** `../swagger.json`
- **Purpose:** OpenAPI/Swagger specification
- **Served at:** `/swagger`
- **Optional:** Swagger page won't work without it

---

## ğŸš« Why Demo Can't Be Standalone

The demo HTML file (`demo/index.html`) is just a **frontend UI**. It:

1. âœ… Makes API calls to PayPortal endpoints
2. âœ… Displays forms and results
3. âœ… Has all the interactive elements

But it **needs a backend server** to:

1. âŒ Handle payment link creation
2. âŒ Process payment confirmations  
3. âŒ Verify blockchain transactions (mock mode)
4. âŒ Store payment data
5. âŒ Generate QR codes
6. âŒ Serve the API endpoints

**The backend is provided by the PayPortal library (`dist/index.js`), which is started by `demo-server.js`.**

---

## âœ… Correct Usage

### Option 1: Run from Project Root (Recommended)

```bash
# From the PayPortal project root
npm install          # Install dependencies
npm run build        # Build the library
npm run demo         # Start demo server
```

Then visit: **http://localhost:3003/demo**

### Option 2: Manual Start

```bash
# Build first
npm run build

# Then start server
node demo-server.js
```

---

## ğŸ¯ What You CAN Do

### 1. Customize the Demo UI
You **can** edit `demo/index.html` to:
- Change colors, styles, layout
- Add/remove form fields
- Modify button text and labels
- Update help text and instructions

### 2. Deploy Together
When deploying, you **must** keep this structure:
```
your-deployment/
â”œâ”€â”€ demo/
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ demo-server.js
â”œâ”€â”€ dist/
â”‚   â”œâ”€â”€ index.js
â”‚   â””â”€â”€ (other built files)
â”œâ”€â”€ swagger.json
â”œâ”€â”€ node_modules/
â””â”€â”€ package.json
```

### 3. Use as Embedded Demo
You can embed the demo in your documentation site by:
1. Running the demo server on a subdomain
2. Using iframe to embed `/demo` page
3. Keeping the full project structure intact

---

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Browser (User)                      â”‚
â”‚  Opens: http://localhost:3003/demo         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ HTTP Requests
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         demo-server.js                      â”‚
â”‚  - Serves demo/index.html at /demo         â”‚
â”‚  - Serves swagger.json at /swagger         â”‚
â”‚  - Imports PayPortal library                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Imports
                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         dist/index.js                       â”‚
â”‚  - PayPortal server with mock chains        â”‚
â”‚  - Handles /api/links, /pay/:id, etc.      â”‚
â”‚  - Processes payments (mock mode)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Complete Data Flow Example

### Creating a Payment Link:

1. **User** fills form in `demo/index.html`
2. **Browser** sends `POST /api/links` to `demo-server.js`
3. **demo-server.js** passes request to PayPortal (`dist/index.js`)
4. **PayPortal** creates link in memory storage
5. **PayPortal** returns link data as JSON
6. **Browser** displays success message with link URL

### Testing a Payment:

1. **User** enters link ID in test tab
2. **Browser** sends `GET /pay/:id` 
3. **PayPortal** checks if payment exists
4. **PayPortal** returns `402 Payment Required` with payment details
5. **Browser** displays payment details and QR code
6. **User** clicks "Confirm Payment" with mock tx hash
7. **Browser** sends `POST /pay/:id/confirm`
8. **PayPortal** verifies (mock: always succeeds)
9. **PayPortal** marks payment as confirmed
10. **Browser** shows success âœ…

---

## ğŸ“¦ Making a Portable Demo

If you want a **truly standalone demo** that can be moved anywhere, you would need to:

### Option A: Bundle Everything
Create a Docker container with:
- Node.js runtime
- All dependencies
- Built PayPortal library
- Demo files
- Startup script

```dockerfile
FROM node:18
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
CMD ["node", "demo-server.js"]
EXPOSE 3003
```

### Option B: Static Demo (Limited)
Create a static HTML demo that:
- âœ… Shows UI examples
- âœ… Displays mock data
- âœ… Demonstrates workflows
- âŒ Can't actually create links
- âŒ Can't process payments
- âŒ All fake/simulated data

This would require rewriting the demo to not use real APIs.

---

## ğŸ“ For Developers

If you're building on top of PayPortal:

### Use the Demo as Reference
- Study `demo/index.html` for API usage examples
- See how to format requests
- Learn the response structures
- Understand the payment flow

### Build Your Own UI
You can create your own interface that:
- Runs PayPortal server separately
- Makes API calls to your server
- Implements your own design
- Adds custom features

### API-First Approach
PayPortal is designed as an API-first system:
```
Your App â†’ PayPortal API â†’ Blockchain
```

The demo is just one possible frontend!

---

## ğŸ“ Summary

| Question | Answer |
|----------|--------|
| Can I move demo folder out? | âŒ No, needs parent project |
| Can I edit demo/index.html? | âœ… Yes, customize freely |
| Does demo work standalone? | âŒ No, needs backend server |
| Can I deploy demo alone? | âŒ No, deploy full project |
| Can I use demo as reference? | âœ… Yes, learn from the code |
| Can I build my own UI? | âœ… Yes, use the APIs! |

---

## ğŸ†˜ Troubleshooting

**Demo won't start:**
```bash
# Make sure you're in project root
cd /path/to/PayPortalWeb3/PP

# Install and build
npm install
npm run build
npm run demo
```

**Port already in use:**
```bash
# Edit demo-server.js
# Change: port: 3003
# To: port: 3004 (or any free port)
```

**CSP errors in browser:**
- This is now fixed in the latest version
- Make sure you're running the updated demo-server.js

**Forms not working:**
- Ensure demo-server.js has updated CSP settings
- Check browser console for errors
- Restart the server after changes

---

## ğŸ”— Related Files

- **Main README:** `../README.md`
- **Demo Server:** `../demo-server.js`
- **Swagger Spec:** `../swagger.json`
- **Functionality Status:** `../DEMO_FUNCTIONALITY.md`
- **Package Config:** `../package.json`

---

**Last Updated:** December 2, 2025  
**Version:** 1.0.0

